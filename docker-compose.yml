services:
  connector:
    build: .
    container_name: teamwork-missive-connector
    restart: unless-stopped
    network_mode: host
    volumes:
      - ./logs:/app/logs
    environment:
      # === REQUIRED ===
      - TEAMWORK_BASE_URL=${TEAMWORK_BASE_URL}
      - TEAMWORK_API_KEY=${TEAMWORK_API_KEY}
      - MISSIVE_API_TOKEN=${MISSIVE_API_TOKEN}
      - PG_DSN=${PG_DSN}
      
      # === OPTIONAL: Craft Integration ===
      - CRAFT_BASE_URL=${CRAFT_BASE_URL:-}
      
      # === OPTIONAL: Webhooks ===
      - DISABLE_WEBHOOKS=${DISABLE_WEBHOOKS:-false}
      - NGROK_AUTHTOKEN=${NGROK_AUTHTOKEN:-}
      - TEAMWORK_WEBHOOK_SECRET=${TEAMWORK_WEBHOOK_SECRET:-}
      - MISSIVE_WEBHOOK_SECRET=${MISSIVE_WEBHOOK_SECRET:-}
      
      # === OPTIONAL: Date Filtering ===
      - TEAMWORK_PROCESS_AFTER=${TEAMWORK_PROCESS_AFTER:-}
      - MISSIVE_PROCESS_AFTER=${MISSIVE_PROCESS_AFTER:-}
      - INCLUDE_COMPLETED_TASKS_ON_INITIAL_SYNC=${INCLUDE_COMPLETED_TASKS_ON_INITIAL_SYNC:-true}
      
      # === OPTIONAL: Timing ===
      - PERIODIC_BACKFILL_INTERVAL=${PERIODIC_BACKFILL_INTERVAL:-}
      - BACKFILL_OVERLAP_SECONDS=${BACKFILL_OVERLAP_SECONDS:-120}
      - SPOOL_RETRY_SECONDS=${SPOOL_RETRY_SECONDS:-60}
      
      # === OPTIONAL: Database Resilience ===
      - DB_CONNECT_TIMEOUT=${DB_CONNECT_TIMEOUT:-10}
      - DB_RECONNECT_DELAY=${DB_RECONNECT_DELAY:-5}
      - DB_MAX_RECONNECT_DELAY=${DB_MAX_RECONNECT_DELAY:-60}
      - DB_OPERATION_RETRIES=${DB_OPERATION_RETRIES:-3}
      - MAX_QUEUE_ATTEMPTS=${MAX_QUEUE_ATTEMPTS:-3}
      
      # === OPTIONAL: Application ===
      - APP_PORT=${APP_PORT:-5000}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - TIMEZONE=${TIMEZONE:-Europe/Berlin}
      
      # === OPTIONAL: Logging (Betterstack) ===
      - BETTERSTACK_SOURCE_TOKEN=${BETTERSTACK_SOURCE_TOKEN:-}
      - BETTERSTACK_INGEST_HOST=${BETTERSTACK_INGEST_HOST:-}

